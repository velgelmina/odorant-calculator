<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç –æ–¥–æ—Ä–∞–Ω—Ç–∞ –ì–†–°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-save {
            background: #4CAF50;
            color: white;
        }
        
        .btn-save:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-save:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .btn-view-data {
            background: #2196F3;
            color: white;
            font-size: 14px;
            padding: 10px;
        }
        
        .btn-view-data:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }
        
        .btn-settings {
            background: #ff9800;
            color: white;
            font-size: 14px;
            padding: 10px;
        }
        
        .result {
            background: #f0f7ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: slideIn 0.5s;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-value {
            font-size: 36px;
            color: #667eea;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .result-label {
            color: #555;
            font-size: 14px;
        }
        
        .message {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            display: none;
            font-size: 14px;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        
        .setup-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .setup-section.configured {
            background: #d4edda;
            border-color: #4CAF50;
        }
        
        .setup-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
        }
        
        .setup-section.configured .setup-title {
            color: #155724;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #667eea;
        }
        
        .loading.show {
            display: block;
        }
        
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .settings-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 450px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .instruction-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.6;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° –†–∞—Å—á–µ—Ç –æ–¥–æ—Ä–∞–Ω—Ç–∞</h1>
        <div class="subtitle">–ì–∞–∑–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è</div>
        
        <div id="setupSection" class="setup-section">
            <div class="setup-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</div>
            <button class="btn btn-settings" onclick="openSettings()">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google –¢–∞–±–ª–∏—Ü—É</button>
        </div>
        
        <div class="form-group">
            <label for="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä (—Å–º–µ–Ω–∞):</label>
            <select id="operator">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</option>
                <option value="–°–º–µ–Ω–∞ 1">–°–º–µ–Ω–∞ 1</option>
                <option value="–°–º–µ–Ω–∞ 2">–°–º–µ–Ω–∞ 2</option>
                <option value="–°–º–µ–Ω–∞ 3">–°–º–µ–Ω–∞ 3</option>
                <option value="–°–º–µ–Ω–∞ 4">–°–º–µ–Ω–∞ 4</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="gasLevel">–ù–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –≥–∞–∑–∞ (–º¬≥/—á):</label>
            <input type="number" id="gasLevel" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" step="0.01">
        </div>
        
        <div class="form-group">
            <label for="gasFlow">–†–∞—Å—Ö–æ–¥ –≥–∞–∑–∞ –ø–æ —Ç—Ä—É–±–µ (–º¬≥):</label>
            <input type="number" id="gasFlow" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" step="0.01">
        </div>
        
        <button class="btn btn-calculate" onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        
        <div id="result" class="result">
            <div class="result-label">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–∞–ø–µ–ª—å –æ–¥–æ—Ä–∞–Ω—Ç–∞ –≤ –º–∏–Ω—É—Ç—É:</div>
            <div class="result-value" id="resultValue">0</div>
            <button class="btn btn-save" onclick="saveData()" id="saveBtn">‚òÅÔ∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        </div>
        
        <div id="loading" class="loading">‚è≥ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</div>
        <div id="message" class="message"></div>
        
        <button class="btn btn-view-data" onclick="openSheet()">üìä –û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="settings-modal">
        <div class="settings-content">
            <div class="settings-header">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button class="close-btn" onclick="closeSettings()">‚úï</button>
            </div>
            
            <div class="instruction-box">
                <strong>üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï:</strong><br><br>
                
                <strong>–®–∞–≥ 1:</strong> –°–æ–∑–¥–∞–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É<br>
                ‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ drive.google.com<br>
                ‚Ä¢ –°–æ–∑–¥–∞—Ç—å ‚Üí Google –¢–∞–±–ª–∏—Ü—ã<br>
                ‚Ä¢ –ù–∞–∑–æ–≤–∏—Ç–µ "–û—Ç—á–µ—Ç –æ–¥–æ—Ä–∞–Ω—Ç–∞ –ì–†–°"<br><br>
                
                <strong>–®–∞–≥ 2:</strong> –°–æ–∑–¥–∞–π—Ç–µ Apps Script<br>
                ‚Ä¢ –í —Ç–∞–±–ª–∏—Ü–µ: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script<br>
                ‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ google-apps-script.js<br>
                ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç<br><br>
                
                <strong>–®–∞–≥ 3:</strong> –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ<br>
                ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" ‚Üí "–ù–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"<br>
                ‚Ä¢ –¢–∏–ø: "–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"<br>
                ‚Ä¢ –í—ã–ø–æ–ª–Ω—è—Ç—å: "–ú–æ–µ"<br>
                ‚Ä¢ –î–æ—Å—Ç—É–ø: "–í—Å–µ"<br>
                ‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è<br><br>
                
                <strong>–®–∞–≥ 4:</strong> –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∏–∂–µ
            </div>
            
            <div class="form-group">
                <label for="scriptUrl">URL Apps Script (–¥–ª—è –∑–∞–ø–∏—Å–∏):</label>
                <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/...">
            </div>
            
            <div class="form-group">
                <label for="sheetUrl">URL Google –¢–∞–±–ª–∏—Ü—ã (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞):</label>
                <input type="text" id="sheetUrl" placeholder="https://docs.google.com/spreadsheets/d/...">
            </div>
            
            <button class="btn btn-save" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = function() {
            const scriptUrl = localStorage.getItem('scriptUrl');
            const sheetUrl = localStorage.getItem('sheetUrl');
            
            if (scriptUrl && sheetUrl) {
                document.getElementById('setupSection').classList.add('configured');
                document.querySelector('.setup-title').textContent = '‚úÖ –û–±–ª–∞–∫–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ';
            }
        };
        
        // ============ –§–û–†–ú–£–õ–ê –†–ê–°–ß–ï–¢–ê ============
        // –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–£ –†–ï–ê–õ–¨–ù–£–Æ –§–û–†–ú–£–õ–£!
        function calculateOdorant(gasLevel, gasFlow) {
            // –ü—Ä–∏–º–µ—Ä: –∫–∞–ø–µ–ª—å/–º–∏–Ω = (—Ä–∞—Å—Ö–æ–¥_–≥–∞–∑–∞ * –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å) / 1000
            // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–£ –§–û–†–ú–£–õ–£:
            return (gasFlow * gasLevel) / 1000;
        }
        
        function calculate() {
            const operator = document.getElementById('operator').value;
            const gasLevel = parseFloat(document.getElementById('gasLevel').value);
            const gasFlow = parseFloat(document.getElementById('gasFlow').value);
            
            if (!operator) {
                showMessage('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞!', 'error');
                return;
            }
            
            if (!gasLevel || !gasFlow) {
                showMessage('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }
            
            if (gasLevel <= 0 || gasFlow <= 0) {
                showMessage('‚ùå –ó–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è!', 'error');
                return;
            }
            
            const result = calculateOdorant(gasLevel, gasFlow);
            
            document.getElementById('resultValue').textContent = result.toFixed(2);
            document.getElementById('result').classList.add('show');
            
            window.currentCalculation = {
                operator: operator,
                gasLevel: gasLevel,
                gasFlow: gasFlow,
                result: result.toFixed(2),
                timestamp: new Date().toLocaleString('ru-RU')
            };
            
            hideMessage();
        }
        
        async function saveData() {
            const scriptUrl = localStorage.getItem('scriptUrl');
            
            if (!scriptUrl) {
                showMessage('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ!', 'error');
                openSettings();
                return;
            }
            
            if (!window.currentCalculation) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç!', 'error');
                return;
            }
            
            document.getElementById('loading').classList.add('show');
            document.getElementById('saveBtn').disabled = true;
            
            try {
                const response = await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(window.currentCalculation)
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∞–∫–∂–µ –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
                let localData = JSON.parse(localStorage.getItem('odorantData') || '[]');
                localData.push(window.currentCalculation);
                localStorage.setItem('odorantData', JSON.stringify(localData));
                
                showMessage('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ!', 'success');
                
                document.getElementById('gasLevel').value = '';
                document.getElementById('gasFlow').value = '';
                document.getElementById('result').classList.remove('show');
                window.currentCalculation = null;
                
            } catch (error) {
                showMessage('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            } finally {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('saveBtn').disabled = false;
            }
        }
        
        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
            
            const scriptUrl = localStorage.getItem('scriptUrl') || '';
            const sheetUrl = localStorage.getItem('sheetUrl') || '';
            
            document.getElementById('scriptUrl').value = scriptUrl;
            document.getElementById('sheetUrl').value = sheetUrl;
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }
        
        function saveSettings() {
            const scriptUrl = document.getElementById('scriptUrl').value.trim();
            const sheetUrl = document.getElementById('sheetUrl').value.trim();
            
            if (!scriptUrl || !sheetUrl) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è!');
                return;
            }
            
            localStorage.setItem('scriptUrl', scriptUrl);
            localStorage.setItem('sheetUrl', sheetUrl);
            
            document.getElementById('setupSection').classList.add('configured');
            document.querySelector('.setup-title').textContent = '‚úÖ –û–±–ª–∞–∫–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ';
            
            closeSettings();
            showMessage('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
        }
        
        function openSheet() {
            const sheetUrl = localStorage.getItem('sheetUrl');
            if (!sheetUrl) {
                showMessage('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É!', 'error');
                openSettings();
                return;
            }
            window.open(sheetUrl, '_blank');
        }
        
        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = 'message ' + type;
            setTimeout(hideMessage, 4000);
        }
        
        function hideMessage() {
            document.getElementById('message').className = 'message';
        }
    </script>
</body>
</html>
